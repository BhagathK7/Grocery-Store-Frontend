{"ast":null,"code":"import React,{useState,useEffect}from'react';import{useNavigate}from'react-router-dom';import'./CartPage.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const CartPage=()=>{const[cart,setCart]=useState([]);const[totalAmount,setTotalAmount]=useState(0);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);const navigate=useNavigate();const userId=localStorage.getItem('userId');// ✅ Moved inside the component\nuseEffect(()=>{if(!userId){setError(\"No user ID provided. Please log in.\");setLoading(false);return;}const fetchCart=async()=>{try{const response=await fetch(`http://localhost:5000/api/cart/${userId}`);if(!response.ok)throw new Error('Failed to fetch cart');const data=await response.json();if(data&&data.products){setCart(data.products);const total=data.products.reduce((acc,item)=>{var _item$productId;const price=((_item$productId=item.productId)===null||_item$productId===void 0?void 0:_item$productId.price)||0;return acc+price*item.quantity;},0);setTotalAmount(total);}else{setCart([]);setTotalAmount(0);}}catch(error){console.error('Error fetching cart:',error);setError('Could not fetch the cart. Please try again later.');}finally{setLoading(false);}};fetchCart();},[userId]);const handleCheckout=async()=>{try{const res=await fetch('http://localhost:5000/api/payment',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({products:cart,total:totalAmount,userId})});const data=await res.json();const options={key:data.key,amount:totalAmount*100,currency:\"INR\",name:\"Grocery Store\",description:\"Order Payment\",order_id:data.order_id,handler:async function(response){try{await fetch('http://localhost:5000/api/save-payment',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({userId,orderId:response.razorpay_order_id,paymentId:response.razorpay_payment_id,amount:totalAmount,currency:\"INR\",products:cart})});}catch(err){console.error('Error saving payment:',err);}navigate('/order-summary',{state:{orderDetails:{total:totalAmount},paymentDetails:response}});},prefill:{name:\"Customer\",email:\"customer@example.com\",contact:\"9999999999\"},theme:{color:\"#3399cc\"}};const razorpay=new window.Razorpay(options);razorpay.open();}catch(err){console.error(\"Payment error:\",err);alert(\"Failed to initiate payment. Please try again.\");}};if(loading)return/*#__PURE__*/_jsx(\"p\",{children:\"Loading...\"});if(error)return/*#__PURE__*/_jsx(\"p\",{children:error});return/*#__PURE__*/_jsxs(\"div\",{className:\"cart-page\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Your Cart\"}),/*#__PURE__*/_jsx(\"div\",{className:\"cart-items\",children:cart.length>0?cart.map((item,index)=>{var _item$productId2,_item$productId3,_item$productId4,_item$productId5,_item$productId5$pric,_item$productId6;return/*#__PURE__*/_jsxs(\"div\",{className:\"cart-card\",children:[/*#__PURE__*/_jsx(\"img\",{src:(_item$productId2=item.productId)===null||_item$productId2===void 0?void 0:_item$productId2.image,alt:((_item$productId3=item.productId)===null||_item$productId3===void 0?void 0:_item$productId3.name)||\"Product\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"cart-details\",children:[/*#__PURE__*/_jsx(\"h3\",{children:(_item$productId4=item.productId)===null||_item$productId4===void 0?void 0:_item$productId4.name}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Price: \\u20B9\",(_item$productId5=item.productId)===null||_item$productId5===void 0?void 0:(_item$productId5$pric=_item$productId5.price)===null||_item$productId5$pric===void 0?void 0:_item$productId5$pric.toFixed(2)]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Quantity: \",item.quantity]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Subtotal: \\u20B9\",(((_item$productId6=item.productId)===null||_item$productId6===void 0?void 0:_item$productId6.price)*item.quantity).toFixed(2)]})]})]},index);}):/*#__PURE__*/_jsx(\"p\",{children:\"Your cart is empty.\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"cart-summary\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Order Summary\"}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Total Items: \",cart.reduce((acc,item)=>acc+item.quantity,0)]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Total Amount: \",/*#__PURE__*/_jsxs(\"strong\",{children:[\"\\u20B9\",totalAmount.toFixed(2)]})]}),cart.length>0&&/*#__PURE__*/_jsx(\"button\",{className:\"btn-checkout\",onClick:handleCheckout,children:\"Buy Now\"})]})]});};export default CartPage;","map":{"version":3,"names":["React","useState","useEffect","useNavigate","jsx","_jsx","jsxs","_jsxs","CartPage","cart","setCart","totalAmount","setTotalAmount","loading","setLoading","error","setError","navigate","userId","localStorage","getItem","fetchCart","response","fetch","ok","Error","data","json","products","total","reduce","acc","item","_item$productId","price","productId","quantity","console","handleCheckout","res","method","headers","body","JSON","stringify","options","key","amount","currency","name","description","order_id","handler","orderId","razorpay_order_id","paymentId","razorpay_payment_id","err","state","orderDetails","paymentDetails","prefill","email","contact","theme","color","razorpay","window","Razorpay","open","alert","children","className","length","map","index","_item$productId2","_item$productId3","_item$productId4","_item$productId5","_item$productId5$pric","_item$productId6","src","image","alt","toFixed","onClick"],"sources":["C:/Users/bhaga/OneDrive/Documents/Web Technology/Project/Sample/grocery-store/frontend/src/pages/CartPage.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport './CartPage.css';\r\n\r\nconst CartPage = () => {\r\n  const [cart, setCart] = useState([]);\r\n  const [totalAmount, setTotalAmount] = useState(0);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState(null);\r\n  const navigate = useNavigate();\r\n\r\n  const userId = localStorage.getItem('userId'); // ✅ Moved inside the component\r\n\r\n  useEffect(() => {\r\n    if (!userId) {\r\n      setError(\"No user ID provided. Please log in.\");\r\n      setLoading(false);\r\n      return;\r\n    }\r\n\r\n    const fetchCart = async () => {\r\n      try {\r\n        const response = await fetch(`http://localhost:5000/api/cart/${userId}`);\r\n        if (!response.ok) throw new Error('Failed to fetch cart');\r\n\r\n        const data = await response.json();\r\n        if (data && data.products) {\r\n          setCart(data.products);\r\n          const total = data.products.reduce((acc, item) => {\r\n            const price = item.productId?.price || 0;\r\n            return acc + price * item.quantity;\r\n          }, 0);\r\n          setTotalAmount(total);\r\n        } else {\r\n          setCart([]);\r\n          setTotalAmount(0);\r\n        }\r\n      } catch (error) {\r\n        console.error('Error fetching cart:', error);\r\n        setError('Could not fetch the cart. Please try again later.');\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchCart();\r\n  }, [userId]);\r\n\r\n  const handleCheckout = async () => {\r\n    try {\r\n      const res = await fetch('http://localhost:5000/api/payment', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ products: cart, total: totalAmount, userId })\r\n      });\r\n\r\n      const data = await res.json();\r\n\r\n      const options = {\r\n        key: data.key,\r\n        amount: totalAmount * 100,\r\n        currency: \"INR\",\r\n        name: \"Grocery Store\",\r\n        description: \"Order Payment\",\r\n        order_id: data.order_id,\r\n        handler: async function (response) {\r\n          try {\r\n            await fetch('http://localhost:5000/api/save-payment', {\r\n              method: 'POST',\r\n              headers: { 'Content-Type': 'application/json' },\r\n              body: JSON.stringify({\r\n                userId,\r\n                orderId: response.razorpay_order_id,\r\n                paymentId: response.razorpay_payment_id,\r\n                amount: totalAmount,\r\n                currency: \"INR\",\r\n                products: cart\r\n              })\r\n            });\r\n          } catch (err) {\r\n            console.error('Error saving payment:', err);\r\n          }\r\n\r\n          navigate('/order-summary', {\r\n            state: {\r\n              orderDetails: { total: totalAmount },\r\n              paymentDetails: response\r\n            }\r\n          });\r\n        },\r\n        prefill: {\r\n          name: \"Customer\",\r\n          email: \"customer@example.com\",\r\n          contact: \"9999999999\"\r\n        },\r\n        theme: {\r\n          color: \"#3399cc\"\r\n        }\r\n      };\r\n\r\n      const razorpay = new window.Razorpay(options);\r\n      razorpay.open();\r\n    } catch (err) {\r\n      console.error(\"Payment error:\", err);\r\n      alert(\"Failed to initiate payment. Please try again.\");\r\n    }\r\n  };\r\n\r\n  if (loading) return <p>Loading...</p>;\r\n  if (error) return <p>{error}</p>;\r\n\r\n  return (\r\n    <div className=\"cart-page\">\r\n      <h2>Your Cart</h2>\r\n      <div className=\"cart-items\">\r\n        {cart.length > 0 ? (\r\n          cart.map((item, index) => (\r\n            <div key={index} className=\"cart-card\">\r\n              <img src={item.productId?.image} alt={item.productId?.name || \"Product\"} />\r\n              <div className=\"cart-details\">\r\n                <h3>{item.productId?.name}</h3>\r\n                <p>Price: ₹{item.productId?.price?.toFixed(2)}</p>\r\n                <p>Quantity: {item.quantity}</p>\r\n                <p>Subtotal: ₹{(item.productId?.price * item.quantity).toFixed(2)}</p>\r\n              </div>\r\n            </div>\r\n          ))\r\n        ) : (\r\n          <p>Your cart is empty.</p>\r\n        )}\r\n      </div>\r\n\r\n      <div className=\"cart-summary\">\r\n        <h3>Order Summary</h3>\r\n        <p>Total Items: {cart.reduce((acc, item) => acc + item.quantity, 0)}</p>\r\n        <p>Total Amount: <strong>₹{totalAmount.toFixed(2)}</strong></p>\r\n        {cart.length > 0 && (\r\n          <button className=\"btn-checkout\" onClick={handleCheckout}>\r\n            Buy Now\r\n          </button>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default CartPage;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}